a
    Ğ§Ğ“aÑ„  Ğ³                   @   sF  d dl mZmZmZmZmZmZmZmZ d dl	m
Z
mZ d dlT d dl
Z
G ddâ€ dÑ“ZedkÑ’rBedÑ“Zd	D ]ZeÂ eĞ qleÂ d
Ğ eÂ g dÑĞ eÂ ddd
e
j
Â Ğ â€º dÑœĞ eÂ ddde
j
Â Ğ â€º dÑœĞ eeÂ Ğ Ñ“ eeÂ Ğ Ñ“ eeÂ dĞÑ“ eeÂ dĞÑ“ eeÂ dĞÑ“ eejddĞŒÑ“ eeÂ dĞÑ“ eÂ d
Ğ eeÂ Ğ Ñ“ dS )Ğ¹    )Ğª
create_engineĞªTableĞªColumnĞªIntegerĞªStringĞªTextĞªMetaDataĞªDateTime)ĞªmapperĞªsessionmaker)Ğª*Nc                   @   sâ‚¬   e Zd ZG ddâ€ dÑ“ZG ddâ€ dÑ“ZG ddâ€ dÑ“Zddâ€ Zd	d
â€ Zddâ€ Zd
dâ€ Z	ddâ€ Z
ddâ€ Zddâ€ Zddâ€ Z
ddâ€ Zdddâ€ZdS )ĞªClientDatabasec                   @   s   e Zd Zddâ€ ZdS )zClientDatabase.KnownUsersc                 C   s   d | _ || _d S Â©N)ĞªidĞªusernameÂ©ĞªselfĞªuserÂ© r   ÑŠT/home/su/Projects/GeekBrains/data-base-and-PyQt/lesson_4/practice/client_database.pyĞª__init__   s    z"ClientDatabase.KnownUsers.__init__NÂ©Ğª__name__Ğª
__module__Ğª__qualname__r   r   r   r   r   Ğª
KnownUsers
   s   r   c                   @   s   e Zd Zddâ€ ZdS )zClientDatabase.MessageHistoryc                 C   s(   d | _ || _|| _|| _tjÂ Ğ | _d S r   )r   Ğª	from_userĞªto_userĞªmessageĞªdatetimeĞªnowĞªdate)r   r   r   r   r   r   r   r      s
    z&ClientDatabase.MessageHistory.__init__Nr   r   r   r   r   ĞªMessageHistory   s   r"   c                   @   s   e Zd Zddâ€ ZdS )zClientDatabase.Contactsc                 C   s   d | _ || _d S r   )r   ĞªnameÂ©r   Ğªcontactr   r   r   r      s    z ClientDatabase.Contacts.__init__Nr   r   r   r   r   ĞªContacts   s   r&   c           
   C   s  t d|â€º dÑœddddidĞŒ| _tÑ“ | _td| jtdtd	d
ĞŒtdtÑ“Ñ“}td| jtdtd	d
ĞŒtd
tÑ“tdtÑ“tdtÑ“tdt	Ñ“Ñ“}td| jtdtd	d
ĞŒtdtd	dĞŒÑ“}| jÂ 
| jĞ t| j|Ñ“ t| j
|Ñ“ t| j|Ñ“ t| jdĞŒ}|Ñ“ | _| jÂ | jĞÂ Ğ  | jÂ Ğ  d S )Nzsqlite:///client_z.db3Fi   Zcheck_same_thread)ZechoZpool_recycleZconnect_argsZknown_usersr   T)Zprimary_keyr   Zmessage_historyr   r   r   r!   Ğªcontactsr#   )Ğªunique)Ğªbind)r   Zdatabase_enginer   Ğªmetadatar   r   r   r   r   r	   Z
create_allr
   r   r"   r&   r   ĞªsessionĞªqueryĞªdeleteĞªcommit)r   r#   ZusersĞªhistoryr'   ZSessionr   r   r   r      s6    ÑÑÑ‹	ÑzClientDatabase.__init__c                 C   s>   | j Â | jĞj|dĞŒÂ Ğ s:| Â |Ğ}| j Â |Ğ | j Â Ğ  d S Â©NÂ©r#   )r+   r,   r&   Ğª	filter_byĞªcountĞªaddr.   )r   r%   Zcontact_rowr   r   r   Ğªadd_contactO   s    
zClientDatabase.add_contactc                 C   s   | j Â | jĞj|dĞŒÂ Ğ  d S r0   )r+   r,   r&   r2   r-   r$   r   r   r   Ğªdel_contactV   s    zClientDatabase.del_contactc                 C   s@   | j Â | jĞÂ Ğ  |D ]}| Â |Ğ}| j Â |Ğ q| j Â Ğ  d S r   )r+   r,   r   r-   r4   r.   )r   Ğª
users_listr   Zuser_rowr   r   r   Ğª	add_users[   s
    
zClientDatabase.add_usersc                 C   s(   | Â  |||Ğ}| jÂ |Ğ | jÂ Ğ  d S r   )r"   r+   r4   r.   )r   r   r   r   Zmessage_rowr   r   r   Ğªsave_messagec   s    zClientDatabase.save_messagec                 C   s   ddâ€ | j Â | jjĞÂ Ğ D Ñ“S )Nc                 S   s   g | ]}|d  â€˜qS Â©r   r   )Ğª.0r%   r   r   r   Ğª
<listcomp>j   Ñƒ    z/ClientDatabase.get_contacts.<locals>.<listcomp>)r+   r,   r&   r#   ĞªallÂ©r   r   r   r   Ğªget_contactsi   s    zClientDatabase.get_contactsc                 C   s   ddâ€ | j Â | jjĞÂ Ğ D Ñ“S )Nc                 S   s   g | ]}|d  â€˜qS r:   r   )r;   r   r   r   r   r<   n   r=   z,ClientDatabase.get_users.<locals>.<listcomp>)r+   r,   r   r   r>   r?   r   r   r   Ğª	get_usersm   s    zClientDatabase.get_usersc                 C   s&   | j Â | jĞj|dĞŒÂ Ğ rdS dS d S )N)r   TF)r+   r,   r   r2   r3   r   r   r   r   Ğª
check_userq   s    zClientDatabase.check_userc                 C   s&   | j Â | jĞj|dĞŒÂ Ğ rdS dS d S )Nr1   TF)r+   r,   r&   r2   r3   r$   r   r   r   Ğª
check_contactx   s    zClientDatabase.check_contactNc                 C   s@   | j Â | jĞ}|r|j|dĞŒ}|r.|j|dĞŒ}ddâ€ |Â Ğ D Ñ“S )N)r   )r   c                 S   s    g | ]}|j |j|j|jfâ€˜qS r   )r   r   r   r!   )r;   Zhistory_rowr   r   r   r<   â€¦   s   Ñz.ClientDatabase.get_history.<locals>.<listcomp>)r+   r,   r"   r2   r>   )r   Ğªfrom_whoĞªto_whor,   r   r   r   Ğªget_history   s    ÑzClientDatabase.get_history)NN)r   r   r   r   r"   r&   r   r5   r6   r8   r9   r@   rA   rB   rC   rF   r   r   r   r   r
      s   	0r
   Ğª__main__Ğªtest1)Ğªtest3Ğªtest4Ğªtest5rJ   )rH   Ğªtest2rI   rJ   rK   rL   u:   Ğ ÑŸĞ¡Ğ‚Ğ Ñ‘Ğ Ğ†Ğ ÂµĞ¡â€š! Ğ¡Ğ Ğ¡â€šĞ ÂµĞ¡ĞƒĞ¡â€šĞ Ñ•Ğ Ğ†Ğ Ñ•Ğ Âµ Ğ¡ĞƒĞ Ñ•Ğ Ñ•Ğ Â±Ğ¡â€°Ğ ÂµĞ Ğ…Ğ Ñ‘Ğ Âµ Ğ Ñ•Ğ¡â€š ÑŠ!uG   Ğ ÑŸĞ¡Ğ‚Ğ Ñ‘Ğ Ğ†Ğ ÂµĞ¡â€š! Ğ¡Ğ Ğ Ò‘Ğ¡Ğ‚Ğ¡Ñ“Ğ Ñ–Ğ Ñ•Ğ Âµ Ğ¡â€šĞ ÂµĞ¡ĞƒĞ¡â€šĞ Ñ•Ğ Ğ†Ğ Ñ•Ğ Âµ Ğ¡ĞƒĞ Ñ•Ğ Ñ•Ğ Â±Ğ¡â€°Ğ ÂµĞ Ğ…Ğ Ñ‘Ğ Âµ Ğ Ñ•Ğ¡â€š Ztest10)rE   rI   )Z
sqlalchemyr   r   r   r   r   r   r   r	   Zsqlalchemy.ormr
   r   Ğªcommon.variablesr   r
   r   Ztest_dbĞªir5   r8   r9   r    Ğªprintr@   rA   rB   rF   r6   r   r   r   r   Ğª<module>   s,   ( 


